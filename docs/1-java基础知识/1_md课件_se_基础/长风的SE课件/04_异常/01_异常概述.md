# 异常

[TOC]



## Java异常概述

> 异常，异常，即是程序运行出现了不正常的情况，报错，并导致程序终止

- 为什么学习异常？
  - 虽然程序员在写程序的时候，总是想把代码写得尽善尽美，充分考虑用户使用的各种情况
  - 但是程序在运行的过程中仍然会碰到非常多的问题
    - 即理想的情况：我们的程序永远不出bug，永远没有问题
    - 实际情况：程序总会出现各种问题
  - 为了描述和处理这些问题，Java就引入了异常体系
- Java当中一切皆对象，当程序产生异常，JVM会把这个异常信息封装成一个对象（类）
  - 类中封装着问题的名称，产生的原因、描述等多个属性信息存在
  - 以及对这些信息进行操作的一系列方法（属性+行为）
  - 这些类通过继承层次构成了Java的异常体系
- **学习异常之前，需要明确的一个重要点**
  - 异常的类和对象中只是存了异常的信息
  - 包括异常的原因，异常的种类等等
  - 但是何时抛出异常，怎么处理异常，不是由异常对象决定的
  - 《女朋友生气原因百科全书》



> Java的异常体系
>
> 生活中也会出先一系列的异常情况，Java中的异常体系有类似的关系



> 我约会的时候碰到的一系列问题

- 假设周末我要和喜欢的女生约会，我们约好了去欢乐谷游玩
  - 出发前，我发现我的衣服有点脏了，我换了身帅气的衣服，还喷了一点香水
    - 约会出发前，必然会检查的问题，但不是大问题，发现问题后很容易解决
  - 出发后，走到一半路程，车突然爆胎了，于是我只好拖车去修理
    - 约会出发后，无法预料的问题，但不是大问题，发现问题后仍然可以解决
  - 因为修车的缘故，我不能按时到达，女孩很生气，取消了这次约会
    - 约会出发后，无法预料的问题，无法解决，严重错误



> ###### 把生活中的情况，类比一下Java程序

- 约会出发前----->程序的编译期，代码执行之前
- 约会出发后------>程序的运行期间



> Java程序运行时碰到了一系列的问题

- 编译时期，必须要检查处理的异常，不检查不能通过编译。即便发现了问题，仍然可以解决
- 运行期间，无法预料的问题，但是出现问题后，我们仍然能解决它
- 运行期间，无法预料的问题，但是出现问题后，无法解决它，是一个严重的错误



> 我们一般根据问题能不能处理，也就是问题的严重程度，来区分异常和错误

- Java程序运行时碰到了一系列的问题
  - 严重问题
    - 运行时，无法预料，且无法解决的错误
  - 一般问题
    - 编译时要检查处理的异常，出现问题，可以被解决
    - 运行时，无法预料，且能够被解决的问题



> Java异常体系确实就是这样划分的

- Throwable（祖先类）
  - Error
  - Exception
    - RuntimeException 运行时异常
    - 非RuntimeException 编译时异常
  
- Throwable是Java一切错误和异常的父类，是继承层次中的祖先类
  
  - 表示可以由程序显式或者JVM抛出的问题
  
- Error是严重问题，无法被解决 
  - Error描述了Java运行时虚拟机内部错误和资源耗尽错误
  - 对于Error，程序自己是无能为力的，仅靠程序本身是无法恢复和和预防
  - 于是程序只能尽量安全得保存数据， 然后终止程序，并通知用户去解决
  - 常见的Error是栈溢出，或者堆溢出这些错误
  
- Exception是一般问题，能够被解决
  - RuntimeException，指的是在程序运行期间，发生的一般问题，称之为**运行时异常**
    - 这种问题无法在编译时检查和预料，只有到程序运行后才能显现问题
    - 例如用null调用方法，数组使用错误的下标，错误的强制类型转换
    - RuntimeException可以写代码进行正常的处理，属于一般问题

  > 需要明确的是：
  >
  > 运行时异常绝大多数都是因为编码问题所导致的
  >
  > 也就是可以避免的异常，当程序抛出该异常后，最好能够重构代码，修正问题

  - 非RuntimeException，指的是在编译时期，就需要显式的检查并处理的异常，称之为**编译时异常**
    - 部分书籍也称其为，受检查的异常（Checked Exception）
    - 这种异常必须在编译期检查和处理
    - 例如打开一个文件夹（要考虑该文件夹存不存在）
    - 克隆一个对象（要检查该类是否实现Cloneable接口）
    - Exception的子类中，只要不是RuntimeException的子类，那必然是非RuntimeException

![img](01_%E5%BC%82%E5%B8%B8%E6%A6%82%E8%BF%B0.assets/webp.webp)

> Error和Exception的异同

- 两者都继承自Throwable类，共同构成了Java的异常体系
- Error类一般是指与虚拟机相关的问题，如系统崩溃，虚拟机错误，内存空间不足，方法调用栈溢出等
  - 对于这类错误的导致的应用程序中断，仅靠程序本身无法恢复和和预防
  - 遇到这样的错误，只好尽量安全得保存数据， 然后终止程序，并通知用户去解决
  - Error一般都不由程序显式的抛出，而是由JVM抛出
- Exception类表示程序可以处理的异常，可以捕获且可能恢复
  - 遇到这类异常，应该尽可能处理异常，使程序恢复运行，而不应该随意地终止程序
  - Exception又分为RuntimeException（运行时异常）和非RuntimeException（编译时异常）
    - 运行时异常不受编译器检查，在程序运行期间发生
    - ，一旦发生，若不处理就会导致程序终止
      - 运行时异常包括所有RuntimeException的子类
    - 编译时异常受编译器检查，必须显式地处理该异常，才能够通过编译
      - 编译时异常包括所有Exception的子类中，非RuntimeException的子类的类



> Java设计异常体系的原则

- 尽量把一切错误，摒弃在程序运行之前，最好在编译时期就发现程序潜在的问题（通过编译器）
- 确实，Java把相当一部分异常定义为编译时异常，让程序员在编译时期就显式的处理它们
- 但仍然有很多问题，必须要Java程序运行起来，才可能产生，被发现，是编译器检查不到的
  - 这就是运行时异常



